generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}
model avaliacao {
  id               String   @id
  usuarioId        String
  produtoId        String
  nota             Int      @default(5)
  comentario       String?
  compraVerificada Boolean  @default(false)
  criadoEm         DateTime @default(now())
  atualizadoEm     DateTime @default(now())
  produto          produto  @relation(fields: [produtoId], references: [id])
  usuario          usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([usuarioId, produtoId])
  @@index([produtoId])
  @@index([usuarioId])
}

model carrinho {
  id           String         @id
  usuarioId    String         @unique
  criadoEm     DateTime       @default(now())
  atualizadoEm DateTime       @default(now())
  usuario      usuario        @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  itemcarrinho itemcarrinho[]
}

model categoria {
  id              String      @id
  nome            String      @unique
  descricao       String?
  slug            String      @unique
  paiId           String?
  criadoEm        DateTime    @default(now())
  atualizadoEm    DateTime    @default(now())
  categoria       categoria?  @relation("categoriaTocategoria", fields: [paiId], references: [id])
  other_categoria categoria[] @relation("categoriaTocategoria")
  produto         produto[]   @relation("produtocategorias")

  @@index([paiId])
  @@index([slug])
}

model devolucao {
  id           String     @id
  usuarioId    String
  pedidoId     String
  itemPedidoId String
  motivo       String
  descricao    String?
  status       String     @default("PENDENTE")
  solicitadoEm DateTime   @default(now())
  aprovadoEm   DateTime?
  concluidoEm  DateTime?
  criadoEm     DateTime   @default(now())
  atualizadoEm DateTime   @default(now())
  itempedido   itempedido @relation(fields: [itemPedidoId], references: [id], onDelete: Cascade)
  pedido       pedido     @relation(fields: [pedidoId], references: [id], onDelete: Cascade)
  usuario      usuario    @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@index([itemPedidoId])
  @@index([pedidoId])
  @@index([status])
  @@index([usuarioId])
}

model endereco {
  id           String   @id
  usuarioId    String
  rua          String
  numero       String
  complemento  String?
  bairro       String
  cidade       String
  estado       String
  cep          String
  pais         String   @default("Brasil")
  padrao       Boolean  @default(false)
  criadoEm     DateTime @default(now())
  atualizadoEm DateTime @default(now())
  usuario      usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  pedido       pedido[]

  @@index([usuarioId])
}

model historicostatuspedido {
  id          String                       @id
  pedidoId    String
  status      historicostatuspedido_status
  observacoes String?
  alteradoEm  DateTime                     @default(now())
  alteradoPor String?
  pedido      pedido                       @relation(fields: [pedidoId], references: [id], onDelete: Cascade)

  @@index([alteradoEm])
  @@index([pedidoId])
}

model imagemproduto {
  id        String   @id
  produtoId String
  url       String
  textoAlt  String?
  principal Boolean  @default(false)
  ordem     Int      @default(0)
  criadoEm  DateTime @default(now())
  produto   produto  @relation(fields: [produtoId], references: [id], onDelete: Cascade)

  @@unique([produtoId, principal])
  @@index([produtoId])
}

model itemcarrinho {
  id              String   @id
  carrinhoId      String
  produtoId       String
  quantidade      Int      @default(1)
  precoNoCarrinho Float    // Alterado de Decimal para Float
  criadoEm        DateTime @default(now())
  atualizadoEm    DateTime @default(now())
  carrinho        carrinho @relation(fields: [carrinhoId], references: [id], onDelete: Cascade)
  produto         produto  @relation(fields: [produtoId], references: [id])

  @@unique([carrinhoId, produtoId])
  @@index([carrinhoId])
  @@index([produtoId])
}

model itempedido {
  id            String      @id
  pedidoId      String
  produtoId     String
  quantidade    Int
  precoUnitario Float       // Alterado de Decimal para Float
  precoTotal    Float       // Alterado de Decimal para Float
  criadoEm      DateTime    @default(now())
  devolucao     devolucao[]
  pedido        pedido      @relation(fields: [pedidoId], references: [id], onDelete: Cascade)
  produto       produto     @relation(fields: [produtoId], references: [id])

  @@index([pedidoId])
  @@index([produtoId])
}

model pagamento {
  id               String           @id
  pedidoId         String
  metodoPagamento  String
  gatewayPagamento String
  gatewayId        String?
  status           pagamento_status @default(PENDENTE)
  valor            Float            // Alterado de Decimal para Float
  ultimosQuatro    String?
  bandeira         String?
  metadata         String?
  processadoEm     DateTime?
  criadoEm         DateTime         @default(now())
  atualizadoEm     DateTime         @default(now())
  pedido           pedido           @relation(fields: [pedidoId], references: [id], onDelete: Cascade)

  @@index([gatewayId])
  @@index([pedidoId])
  @@index([status])
}

model pedido {
  id                    String                  @id
  numeroPedido          String                  @unique
  usuarioId             String
  enderecoId            String
  status                pedido_status           @default(PAGAMENTO_PENDENTE)
  subtotal              Float                   // Alterado de Decimal para Float
  frete                 Float                   // Alterado de Decimal para Float
  imposto               Float                   // Alterado de Decimal para Float
  desconto              Float                   @default(0.00) // Alterado de Decimal para Float
  total                 Float                   // Alterado de Decimal para Float
  codigoRastreio        String?
  metodoEnvio           String
  entregaEstimada       DateTime?
  entregueEm            DateTime?
  observacoes           String?
  criadoEm              DateTime                @default(now())
  atualizadoEm          DateTime                @default(now())
  devolucao             devolucao[]
  historicostatuspedido historicostatuspedido[]
  itempedido            itempedido[]
  pagamento             pagamento[]
  endereco              endereco                @relation(fields: [enderecoId], references: [id])
  usuario               usuario                 @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  cupomId               String?
  cupom                 cupom?                  @relation(fields: [cupomId], references: [id])

  @@index([criadoEm])
  @@index([enderecoId])
  @@index([numeroPedido])
  @@index([status])
  @@index([usuarioId])
}

model produto {
  id                 String          @id
  nome               String
  descricao          String?
  preco              Float           // Alterado de Decimal para Float
  precoDesconto      Float?          // Alterado de Decimal para Float
  percentualDesconto Float?          @default(0)
  descontoAte        DateTime?
  estoque            Int             @default(0)
  sku                String          @unique
  ativo              Boolean         @default(true)
  emDestaque         Boolean         @default(false)
  criadoEm           DateTime        @default(now())
  atualizadoEm       DateTime        @default(now())
  avaliacao          avaliacao[]
  imagemproduto      imagemproduto[]
  itemcarrinho       itemcarrinho[]
  itempedido         itempedido[]
  categoria          categoria[]     @relation("produtocategorias")

  @@index([ativo])
  @@index([estoque])
  @@index([nome])
  @@index([sku])
}

model tokenverificacao {
  id        String    @id
  usuarioId String
  token     String    @unique
  tipo      String
  expiraEm  DateTime
  usado     Boolean   @default(false)
  usadoEm   DateTime?
  criadoEm  DateTime  @default(now())
  usuario   usuario   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([usuarioId])
}

model usuario {
  id                 String             @id
  email              String             @unique
  telefone           String             @unique
  nome               String
  senhaHash          String
  emailVerificado    Boolean            @default(false)
  telefoneVerificado Boolean            @default(false)
  status             usuario_status     @default(PENDENTE)
  tipo               usuario_tipo       @default(CLIENTE)
  criadoEm           DateTime           @default(now())
  atualizadoEm       DateTime           @default(now())
  ultimoLogin        DateTime?
  googleId           String?
  foto               String?
  resetToken         String?
  resetTokenExpiry   DateTime?
  avaliacao          avaliacao[]
  carrinho           carrinho?
  devolucao          devolucao[]
  endereco           endereco[]
  pedido             pedido[]
  tokenverificacao   tokenverificacao[]

  @@unique([email, telefone])
  @@index([email])
  @@index([telefone])
}

model cupom {
  id         String   @id @default(cuid())
  codigo     String   @unique
  descricao  String?
  tipo       tipo_cupom @default(PERCENTUAL)
  valor      Float
  validoAte  DateTime
  usado      Int      @default(0)
  maxUsage   Int?
  ativo      Boolean  @default(true)
  criadoEm   DateTime @default(now())
  atualizadoEm DateTime @default(now())

  pedido     pedido[]
  
  @@index([codigo])
  @@index([ativo])
  @@index([validoAte])
}

enum tipo_cupom {
  PERCENTUAL
  VALOR_FIXO
}


enum historicostatuspedido_status {
  PAGAMENTO_PENDENTE
  PROCESSANDO
  CONFIRMADO
  PREPARANDO
  ENVIADO
  ENTREGUE
  CANCELADO
  DEVOLVIDO
  REEMBOLSADO
}

enum pedido_status {
  PAGAMENTO_PENDENTE
  PROCESSANDO
  CONFIRMADO
  PREPARANDO
  ENVIADO
  ENTREGUE
  CANCELADO
  DEVOLVIDO
  REEMBOLSADO
}

enum pagamento_status {
  PENDENTE
  PROCESSANDO
  CONCLUIDO
  FALHOU
  REEMBOLSADO
  CANCELADO
}

enum usuario_status {
  PENDENTE
  ATIVO
  SUSPENSO
  DELETADO
}

enum usuario_tipo {
  CLIENTE
  ADMIN
  GERENTE
}